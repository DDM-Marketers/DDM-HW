---
title: "Assignment 3: Promotions Management"
author: "Group 11: Christina Wang, Kailin Fu, Shun Guan, Sylvia Lu, Yiran Huang"
date: "April 20, 2020"
output:
  pdf_document:
    number_sections: yes
    toc: yes
urlcolor: blue
graphics: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = NA, message = FALSE, eval = TRUE,
                      fig.width = 4.5, fig.height = 3, fig.align = "right")
```

\setlength{\parskip}{6pt}
\newpage

# Promotional event planning

\newpage


# Estimating lift factors and promotion ROI analysis

In this part of the assignment, we analyze the effectiveness and ROI of different promotions for Hellman’s 32 oz Mayonnaise. The analysis is based on account level data at Jewel-Osco and Dominick’s Finer Foods in Chicago.
Use the table (data frame) hellmans_df in the file Hellmans.RData. hellmans_DF contains the following variables: \newline
• account \newline
• product \newline
• week \newline
• units \newline
• dollars \newline
• feature_pctacv \newline
• display_pctacv \newline

\medskip


## Question
Create a price variable for Hellman’s 32oz mayo. Then, although not strictly necessary (because the estimated coefficients will scale in a linear regression), you should divide the feature and display columns (variables) by 100.
Examine the feature and display variables. Provide summary statistics (number of observations, mean, standard deviation) and histograms of these variables, separately for both accounts. To what extent do these two promotional instruments differ?
Calculate the correlations between feature_pctacv, display_pctacv, and price (use the cor function in R). Comment on your findings. Do the correlations indicate a potential problem for your regression analysis to be performed below?


```{r, include = FALSE}
    library(ggplot2)
    library(tidyverse)
    library(dplyr)
    library(tidyr)
    library(lfe)
    load("Hellmans.RData")
```

```{r, fig.width = 6, fig.height = 3, fig.align = "center"}

hellmans_df$price = hellmans_df$dollars / hellmans_df$units
hellmans_df$feature = hellmans_df$feature_pctacv / 100
hellmans_df$display = hellmans_df$display_pctacv / 100

my_summary <- function(df, account) {
  df_local = df[df$account == account,]
    list("Feature Summary" = 
       list("count" = length(df_local$feature),
            "mean" = mean(df_local$feature),
            "sd" = sd(df_local$feature)),
       "Display Summary" = 
       list("count" = length(df_local$display),
            "mean" = mean(df_local$display),
            "sd" = sd(df_local$display)))
}

D_summary = my_summary(hellmans_df, "Dominicks")
J_summary = my_summary(hellmans_df, "Jewel")
print(D_summary)
print(J_summary)

hellmans_df %>% 
ggplot(data = ., aes(x=feature, color=account)) + geom_histogram(fill="white") + facet_grid(cols = vars(account))

hellmans_df %>% 
ggplot(data = ., aes(x=display, color=account)) + geom_histogram(fill="white") + facet_grid(cols = vars(account))


#Correlations
cor(hellmans_df$feature_pctacv, hellmans_df$display_pctacv)

cor(hellmans_df$feature_pctacv, hellmans_df$price)

cor(hellmans_df$display_pctacv, hellmans_df$price)
```



\newpage

## Question 
Estimate the log-linear demand model separately for each account, using price as the only explanatory variable. Then add the feature and display variables.
Comment on the difference between the two regressions in terms of goodness of fit, and the price elasticity estimates. Is the change in price elasticity estimates as expected? What is the reason for this change? Are the coefficient estimates similar for both accounts?


```{r, fig.width = 6, fig.height = 3, fig.align = "center"}

D_lm = 
hellmans_df %>% 
filter(account == "Dominicks") %>% 
glm(log(units) ~ log(price), data = .)

summary(D_lm)

J_lm = 
hellmans_df %>% 
filter(account == "Jewel") %>% 
glm(log(units) ~ log(price), data = .)

summary(J_lm)

#Two linear model demand-price graph
hellmans_df %>% 
ggplot(data = ., aes(x= log(units), y = log(price), color=account)) + geom_point(size = 1, alpha = 1) +
  facet_grid(cols = vars(account)) + geom_smooth(method = "lm", se = FALSE)

#Compare with the feature add model

D_d_lm = 
hellmans_df %>% 
filter(account == "Dominicks") %>% 
glm(log(units) ~ log(price) + display, data = .)
summary(D_d_lm)

J_d_lm = 
hellmans_df %>% 
filter(account == "Jewel") %>% 
glm(log(units) ~ log(price) + display, data = .)
summary(J_d_lm)

D_d_f_lm = 
hellmans_df %>% 
filter(account == "Dominicks") %>% 
glm(log(units) ~ log(price) + display + feature, data = .)
summary(D_d_f_lm)

J_d_f_lm = 
hellmans_df %>% 
filter(account == "Jewel") %>% 
glm(log(units) ~ log(price) + display + feature, data = .)
summary(J_d_f_lm)

# add display improve the model, reduce deviance. However, add feature just improve it a little bit, since feature and display has high correlation. The elastict drop from 4.5 to 1.8 to 1.1 around for both account. We can consider display and feature are ommited variables for the first model.
```

\newpage

## Question 
Consider the following three promotions: \newline
(a) 15% TPR \newline
(b) 15% TPR, 70% display \newline
(c) 15% TPR, 70% display, 100% feature \newline
Calculate the lift factors for each promotion for both accounts, based on the regression estimates in 2. Set estimates that are not statistically significant = 0.

```{r, fig.width = 6, fig.height = 3, fig.align = "center"}

D_lm = 
hellmans_df %>% 
filter(account == "Dominicks") %>% 
glm(log(units) ~ log(price), data = .)

summary(D_lm)

J_lm = 
hellmans_df %>% 
filter(account == "Jewel") %>% 
glm(log(units) ~ log(price), data = .)

summary(J_lm)

#Two linear model demand-price graph
hellmans_df %>% 
ggplot(data = ., aes(x= log(units), y = log(price), color=account)) + geom_point(size = 1, alpha = 1) +
  facet_grid(cols = vars(account)) + geom_smooth(method = "lm", se = FALSE)



```
